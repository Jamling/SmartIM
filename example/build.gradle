/*
 * This file was generated by the Gradle 'init' task.
 */
buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "de.gliderpilot.gradle.jnlp:gradle-jnlp-plugin:1.2.6"
    }
}
plugins {
    id 'java'
    id 'application'
    id 'signing'
    id "de.gliderpilot.jnlp" version "1.2.6"
}

version '3.0.0'
mainClassName = 'cn.ieclipse.smartim.Application'
def launcherName = 'SmartIM-App'
def codebaseUrl = 'https://dl.ieclipse.cn/jws'

signing {
    sign configurations.runtimeElements
    //storeFile = file('keystore.jks')
    //storePassword = findProperty('keystore_password')
    //keyAlias = 'swing'
    //keyPassword = findProperty('key_password')
}
jar {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    archiveFileName = "${launcherName}.jar"
    manifest {
        attributes 'Main-Class': "${mainClassName}"
    }
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}
jnlp {
    href "${launcherName}.jnlp"
    codebase "${codebaseUrl}"
    spec '7.0'
    version "${project.version}"
    j2seParams = [version: '7.0+']
    signJarAddedManifestEntries = [
            'Codebase': "${codebaseUrl}",
            'Permissions': 'all-permissions',
            'Application-Name': "${launcherName}"
    ]
    signJarRemovedManifestEntries = '(?:Trusted-Only|Trusted-Library|.*-Digest)'
    mainClassName = "${mainClassName}"
    withXml {
        information {
            title 'SmartIM'
            vendor 'ieclipse.cn'
            homepage 'https://Jamling.github.io/jws/index.html#SmartIM'
            description '微信/QQ Swing版'
            'offline-allowed'()
        }
        security {
            'all-permissions'()
        }
    }
    desc = {
        'application-desc'('main-class': "${mainClassName}") {
            argument('-verbose')
        }
    }
    //signJarParams = [keystore: 'keystore.jks', alias: 'swing', storepass: findProperty('keystore_password').toString()]
}

// 其他配置...

dependencies {
    implementation project(':core')
    implementation project(':smartqq')
    implementation project(':wechat')
}

description = 'smartim-example'